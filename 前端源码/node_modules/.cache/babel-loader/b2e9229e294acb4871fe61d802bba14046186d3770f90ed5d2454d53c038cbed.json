{"ast":null,"code":"import BoxBorder from \"@/views/component/BoxBorder\";\nexport default {\n  name: \"BoxView1\",\n  components: {\n    BoxBorder\n  },\n  data() {\n    return {\n      data: [],\n      socket: null\n    };\n  },\n  methods: {\n    openSocket() {\n      const socketUrl = \"ws://localhost:9999/api/pushMessage\";\n      if (this.socket != null) {\n        this.socket.close();\n        this.socket = null;\n      }\n      this.socket = new WebSocket(socketUrl);\n      //打开事件\n      this.socket.onopen = function () {\n        console.log(\"websocket已打开\");\n      };\n      //获得消息事件\n      this.socket.onmessage = msg => {\n        let data = JSON.parse(msg.data);\n        for (let i = 0; i < data.length; i++) {\n          for (let j = i + 1; j < data.lenth; j++) {\n            let t = data[i];\n            let tData = new Date(t.newTime);\n            let o = data[j];\n            let oData = new Date(o.newTime);\n            if (tData.getTime() < oData.getTime()) {\n              data[i] = o;\n              data[j] = t;\n            }\n          }\n        }\n        this.data = data.map(item => {\n          let start = item.content.indexOf(\"【\");\n          let end = item.content.indexOf(\"】\");\n          return {\n            newsTime: item.newsTime,\n            content: item.content.substring(start, end)\n          };\n        }).filter(item => item.content);\n        //发现消息进入,开始处理前端触发逻辑\n      };\n      //关闭事件\n      this.socket.onclose = function () {\n        console.log(\"websocket已关闭\");\n      };\n      //发生了错误事件\n      this.socket.onerror = function () {\n        console.log(\"websocket发生了错误\");\n      };\n    }\n  },\n  created() {\n    this.openSocket();\n  },\n  destroyed() {\n    if (this.socket != null) {\n      this.socket.close();\n      this.socket = null;\n    }\n  }\n};","map":{"version":3,"names":["BoxBorder","name","components","data","socket","methods","openSocket","socketUrl","close","WebSocket","onopen","console","log","onmessage","msg","JSON","parse","i","length","j","lenth","t","tData","Date","newTime","o","oData","getTime","map","item","start","content","indexOf","end","newsTime","substring","filter","onclose","onerror","created","destroyed"],"sources":["src/views/component/BoxView5.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div style=\"height: calc(100% - 20px); width: calc(100% - 20px); margin: 0 auto; position: relative;\">\r\n      <box-border style=\"height: 100%;\"/>\r\n      <div style=\"position:absolute; top: 0; width: 100%; height: 100%;\">\r\n        <div class=\"box-bg\" style=\"text-align: center; font-size: 20px; color: #FFFFFF; line-height: 35px;\">\r\n          收款\r\n        </div>\r\n        <div style=\" height: calc(100% - 65px); overflow:auto;\">\r\n          <div>\r\n            <div class=\"box-text-bg select-item\" style=\"height: unset\" v-for=\"(item, index) in data\" :key=\"index\" >\r\n              <div style=\"padding: 10px 0;\">{{item.content}} {{item.newsTime}}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport BoxBorder from \"@/views/component/BoxBorder\";\r\nexport default {\r\n  name: \"BoxView1\",\r\n  components: {BoxBorder},\r\n  data() {\r\n    return {\r\n      data: [],\r\n      socket: null,\r\n    }\r\n  },\r\n  methods: {\r\n    openSocket() {\r\n      const socketUrl = \"ws://localhost:9999/api/pushMessage\";\r\n      if(this.socket!=null){\r\n        this.socket.close();\r\n        this.socket=null;\r\n      }\r\n      this.socket = new WebSocket(socketUrl);\r\n      //打开事件\r\n      this.socket.onopen = function() {\r\n        console.log(\"websocket已打开\");\r\n      };\r\n      //获得消息事件\r\n      this.socket.onmessage = (msg) => {\r\n        let data = JSON.parse(msg.data);\r\n        for(let i = 0; i<data.length; i++) {\r\n          for(let j = i + 1; j<data.lenth; j++) {\r\n            let t = data[i];\r\n            let tData = new Date(t.newTime);\r\n\r\n            let o = data[j];\r\n            let oData = new Date(o.newTime);\r\n\r\n            if (tData.getTime() < oData.getTime()) {\r\n              data[i] = o;\r\n              data[j] = t;\r\n            }\r\n          }\r\n        }\r\n        this.data = data.map(item => {\r\n          let start = item.content.indexOf(\"【\");\r\n          let end = item.content.indexOf(\"】\");\r\n          return {\r\n            newsTime: item.newsTime,\r\n            content: item.content.substring(start, end),\r\n          }\r\n        }).filter(item => item.content);\r\n        //发现消息进入,开始处理前端触发逻辑\r\n      };\r\n      //关闭事件\r\n      this.socket.onclose = function() {\r\n        console.log(\"websocket已关闭\");\r\n      };\r\n      //发生了错误事件\r\n      this.socket.onerror = function() {\r\n        console.log(\"websocket发生了错误\");\r\n      }\r\n    }\r\n\r\n  },\r\n  created() {\r\n    this.openSocket();\r\n  },\r\n  destroyed() {\r\n    if(this.socket!=null){\r\n      this.socket.close();\r\n      this.socket=null;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.select-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  color: #FFFFFF;\r\n  padding: 0 30px;\r\n  margin: 10px 20px 0 20px;\r\n  background: rgba(255,0,0,0.1);\r\n  height: 60px;\r\n  box-shadow: -2px 0px 10px rgba(255,0,0,0.7) inset, 2px 0px 10px rgba(255,0,0,0.7) inset !important;\r\n}\r\n</style>"],"mappings":"AAqBA,OAAAA,SAAA;AACA;EACAC,IAAA;EACAC,UAAA;IAAAF;EAAA;EACAG,KAAA;IACA;MACAA,IAAA;MACAC,MAAA;IACA;EACA;EACAC,OAAA;IACAC,WAAA;MACA,MAAAC,SAAA;MACA,SAAAH,MAAA;QACA,KAAAA,MAAA,CAAAI,KAAA;QACA,KAAAJ,MAAA;MACA;MACA,KAAAA,MAAA,OAAAK,SAAA,CAAAF,SAAA;MACA;MACA,KAAAH,MAAA,CAAAM,MAAA;QACAC,OAAA,CAAAC,GAAA;MACA;MACA;MACA,KAAAR,MAAA,CAAAS,SAAA,GAAAC,GAAA;QACA,IAAAX,IAAA,GAAAY,IAAA,CAAAC,KAAA,CAAAF,GAAA,CAAAX,IAAA;QACA,SAAAc,CAAA,MAAAA,CAAA,GAAAd,IAAA,CAAAe,MAAA,EAAAD,CAAA;UACA,SAAAE,CAAA,GAAAF,CAAA,MAAAE,CAAA,GAAAhB,IAAA,CAAAiB,KAAA,EAAAD,CAAA;YACA,IAAAE,CAAA,GAAAlB,IAAA,CAAAc,CAAA;YACA,IAAAK,KAAA,OAAAC,IAAA,CAAAF,CAAA,CAAAG,OAAA;YAEA,IAAAC,CAAA,GAAAtB,IAAA,CAAAgB,CAAA;YACA,IAAAO,KAAA,OAAAH,IAAA,CAAAE,CAAA,CAAAD,OAAA;YAEA,IAAAF,KAAA,CAAAK,OAAA,KAAAD,KAAA,CAAAC,OAAA;cACAxB,IAAA,CAAAc,CAAA,IAAAQ,CAAA;cACAtB,IAAA,CAAAgB,CAAA,IAAAE,CAAA;YACA;UACA;QACA;QACA,KAAAlB,IAAA,GAAAA,IAAA,CAAAyB,GAAA,CAAAC,IAAA;UACA,IAAAC,KAAA,GAAAD,IAAA,CAAAE,OAAA,CAAAC,OAAA;UACA,IAAAC,GAAA,GAAAJ,IAAA,CAAAE,OAAA,CAAAC,OAAA;UACA;YACAE,QAAA,EAAAL,IAAA,CAAAK,QAAA;YACAH,OAAA,EAAAF,IAAA,CAAAE,OAAA,CAAAI,SAAA,CAAAL,KAAA,EAAAG,GAAA;UACA;QACA,GAAAG,MAAA,CAAAP,IAAA,IAAAA,IAAA,CAAAE,OAAA;QACA;MACA;MACA;MACA,KAAA3B,MAAA,CAAAiC,OAAA;QACA1B,OAAA,CAAAC,GAAA;MACA;MACA;MACA,KAAAR,MAAA,CAAAkC,OAAA;QACA3B,OAAA,CAAAC,GAAA;MACA;IACA;EAEA;EACA2B,QAAA;IACA,KAAAjC,UAAA;EACA;EACAkC,UAAA;IACA,SAAApC,MAAA;MACA,KAAAA,MAAA,CAAAI,KAAA;MACA,KAAAJ,MAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}