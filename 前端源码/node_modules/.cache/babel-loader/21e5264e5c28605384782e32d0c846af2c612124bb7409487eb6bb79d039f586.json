{"ast":null,"code":"import \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\n// 标准参数\nvar canvas,\n  ctx,\n  configDefault = {\n    width: 200,\n    height: 200\n  };\nlet config = {\n  text: 'avueJS',\n  // 文字\n  fontFamily: 'microsoft yahei',\n  // 字体\n  color: '#999',\n  // 颜色\n  fontSize: 16,\n  // 大小\n  opacity: 100,\n  // 透明度\n  bottom: 10,\n  // 下边位置\n  right: 10,\n  // 右边位置\n  ratio: 1 // 压缩比\n};\n\n/**\n * 参数 {Object} opt\n * @param {String} text    水印文本，默认'avue商用通用无敌大水印'\n * @param {String} font    水印字体，默认'30px 黑体'\n * @param {Int} canvasWidth    单个水印容器宽度，默认500\n * @param {Int} canvasHeight    单个水印容器高度，默认200\n * @param {String} textAlign    水印文本对齐方式，默认'center'\n * @param {String} textStyle    水印文本样式，默认'rgba(100,100,100,0.15)'\n * @param {Int} degree    水印文本旋转角度，默认 -20\n * @param return\n **/\nexport function dataURLtoFile(dataurl, filename) {\n  let arr = dataurl.split(',');\n  let mime = arr[0].match(/:(.*?);/)[1];\n  let bstr = atob(arr[1]);\n  let n = bstr.length;\n  let u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new File([u8arr], filename, {\n    type: mime\n  });\n}\n\n// file转base64\nexport function fileToBase64(file, callback) {\n  var reader = new FileReader();\n  reader.readAsDataURL(file);\n  reader.onload = function (e) {\n    callback(e.target.result);\n  };\n}\n\n// 图片加水印\nexport function detailImg(file, option = {}, callback) {\n  const {\n    text,\n    fontFamily,\n    color,\n    fontSize,\n    opacity,\n    bottom,\n    right,\n    ratio\n  } = option;\n  initParams();\n  fileToBase64(file, initImg);\n  // 参数初始化\n  function initParams() {\n    config.text = text || config.text;\n    config.fontFamily = fontFamily || config.fontFamily;\n    config.color = color || config.color;\n    config.fontSize = fontSize || config.fontSize;\n    config.opacity = opacity || config.opacity;\n    config.bottom = bottom || config.bottom;\n    config.right = right || config.right;\n    config.ratio = ratio || config.ratio;\n  }\n  // 加载图片\n  function initImg(data) {\n    var img = new Image();\n    img.src = data;\n    img.onload = function () {\n      var width = img.width;\n      var height = img.height;\n      cretedCanvas(width, height);\n      ctx.drawImage(img, 0, 0, width, height);\n      setText(width, height);\n      const base64 = document.getElementById('canvas').toDataURL(file.type, config.ratio);\n      const result = dataURLtoFile(base64, file.name);\n      callback && callback(result);\n    };\n  }\n  // 创建画板\n  function cretedCanvas(width, height) {\n    canvas = document.getElementById('canvas');\n    if (canvas === null) {\n      canvas = document.createElement('canvas');\n      canvas.id = 'canvas';\n      canvas.className = 'avue-canvas';\n      document.body.appendChild(canvas);\n    }\n    ctx = canvas.getContext('2d');\n    canvas.width = width;\n    canvas.height = height;\n  }\n  // 添加水印\n  function setText(width, height) {\n    var txt = config.text;\n    var param = calcParam(txt, width, height);\n    ctx.font = param.fontSize + 'px ' + config.fontFamily;\n    ctx.fillStyle = config.color;\n    ctx.globalAlpha = config.opacity / 100;\n    ctx.fillText(txt, param.x, param.y);\n  }\n  // 计算比例\n  function calcParam(txt, width, height) {\n    var x, y;\n\n    // 字体的比例\n    var calcFontSize = config.fontSize / configDefault.width;\n    var fontSize = calcFontSize * width;\n    if (config.bottom) {\n      y = configDefault.height - config.bottom;\n    } else {\n      y = config.top;\n    }\n    if (config.right) {\n      x = configDefault.width - config.right;\n    } else {\n      x = config.left;\n    }\n    ctx.font = config.fontSize + 'px ' + config.fontFamily;\n    var txtWidth = Number(ctx.measureText(txt).width);\n    x = x - txtWidth;\n    var calcPosX = x / configDefault.width;\n    var calcPosY = y / configDefault.height;\n    x = calcPosX * width;\n    y = calcPosY * height;\n    return {\n      x: x,\n      y: y,\n      fontSize: fontSize\n    };\n  }\n}","map":{"version":3,"names":["canvas","ctx","configDefault","width","height","config","text","fontFamily","color","fontSize","opacity","bottom","right","ratio","dataURLtoFile","dataurl","filename","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","type","fileToBase64","file","callback","reader","FileReader","readAsDataURL","onload","e","target","result","detailImg","option","initParams","initImg","data","img","Image","src","cretedCanvas","drawImage","setText","base64","document","getElementById","toDataURL","name","createElement","id","className","body","appendChild","getContext","txt","param","calcParam","font","fillStyle","globalAlpha","fillText","x","y","calcFontSize","top","left","txtWidth","Number","measureText","calcPosX","calcPosY"],"sources":["C:/Users/26275/Desktop/y0393/前端源码/node_modules/avue-plugin-ueditor/packages/ueditor/src/upload/canvas.js"],"sourcesContent":["// 标准参数\nvar canvas, ctx, configDefault = {\n  width: 200,\n  height: 200\n};\nlet config = {\n  text: 'avueJS', // 文字\n  fontFamily: 'microsoft yahei', // 字体\n  color: '#999', // 颜色\n  fontSize: 16, // 大小\n  opacity: 100, // 透明度\n  bottom: 10, // 下边位置\n  right: 10, // 右边位置\n  ratio: 1// 压缩比\n};\n\n/**\n * 参数 {Object} opt\n * @param {String} text    水印文本，默认'avue商用通用无敌大水印'\n * @param {String} font    水印字体，默认'30px 黑体'\n * @param {Int} canvasWidth    单个水印容器宽度，默认500\n * @param {Int} canvasHeight    单个水印容器高度，默认200\n * @param {String} textAlign    水印文本对齐方式，默认'center'\n * @param {String} textStyle    水印文本样式，默认'rgba(100,100,100,0.15)'\n * @param {Int} degree    水印文本旋转角度，默认 -20\n * @param return\n **/\nexport function dataURLtoFile (dataurl, filename) {\n  let arr = dataurl.split(',');\n  let mime = arr[0].match(/:(.*?);/)[1];\n  let bstr = atob(arr[1]);\n  let n = bstr.length;\n  let u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new File([u8arr], filename, {\n    type: mime\n  });\n}\n\n// file转base64\nexport function fileToBase64 (file, callback) {\n  var reader = new FileReader();\n  reader.readAsDataURL(file);\n  reader.onload = function (e) {\n    callback(e.target.result);\n  };\n}\n\n// 图片加水印\nexport function detailImg (file, option = {}, callback) {\n  const { text, fontFamily, color, fontSize, opacity, bottom, right, ratio } = option;\n  initParams();\n  fileToBase64(file, initImg);\n  // 参数初始化\n  function initParams () {\n    config.text = text || config.text;\n    config.fontFamily = fontFamily || config.fontFamily;\n    config.color = color || config.color;\n    config.fontSize = fontSize || config.fontSize;\n    config.opacity = opacity || config.opacity;\n    config.bottom = bottom || config.bottom;\n    config.right = right || config.right;\n    config.ratio = ratio || config.ratio;\n  }\n  // 加载图片\n  function initImg (data) {\n    var img = new Image();\n    img.src = data;\n    img.onload = function () {\n      var width = img.width;\n      var height = img.height;\n      cretedCanvas(width, height);\n      ctx.drawImage(img, 0, 0, width, height);\n      setText(width, height);\n      const base64 = document.getElementById('canvas').toDataURL(file.type, config.ratio)\n      const result = dataURLtoFile(base64, file.name)\n      callback && callback(result);\n    };\n  }\n  // 创建画板\n  function cretedCanvas (width, height) {\n    canvas = document.getElementById('canvas');\n    if (canvas === null) {\n      canvas = document.createElement('canvas');\n      canvas.id = 'canvas';\n      canvas.className = 'avue-canvas';\n      document.body.appendChild(canvas);\n    }\n    ctx = canvas.getContext('2d');\n    canvas.width = width;\n    canvas.height = height;\n\n  }\n  // 添加水印\n  function setText (width, height) {\n    var txt = config.text;\n    var param = calcParam(txt, width, height);\n    ctx.font = param.fontSize + 'px ' + config.fontFamily;\n    ctx.fillStyle = config.color;\n    ctx.globalAlpha = config.opacity / 100;\n    ctx.fillText(txt, param.x, param.y);\n  }\n  // 计算比例\n  function calcParam (txt, width, height) {\n    var x, y;\n\n    // 字体的比例\n    var calcFontSize = config.fontSize / configDefault.width;\n    var fontSize = calcFontSize * width;\n\n    if (config.bottom) {\n      y = configDefault.height - config.bottom;\n    } else {\n      y = config.top;\n    }\n\n    if (config.right) {\n      x = configDefault.width - config.right;\n    } else {\n      x = config.left;\n    }\n    ctx.font = config.fontSize + 'px ' + config.fontFamily;\n    var txtWidth = Number(ctx.measureText(txt).width);\n\n    x = x - txtWidth;\n\n    var calcPosX = x / configDefault.width;\n    var calcPosY = y / configDefault.height;\n\n    x = calcPosX * width;\n    y = calcPosY * height;\n    return {\n      x: x,\n      y: y,\n      fontSize: fontSize\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}